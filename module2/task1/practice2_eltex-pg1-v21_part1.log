ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/eltex-pg1-v21/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/eltex-pg1-v21/.ssh/id_rsa
Your public key has been saved in /home/eltex-pg1-v21/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:6hiOo9QFScbNnkSe3WLH+vRxY6TpFRUaq7lRGZy86bs eltex-pg1-v21@eltex-2025-autumn
The key's randomart image is:
+---[RSA 3072]----+
|  .o+.      oo.o.|
|  o.o+o o    +B  |
|   ooo.+ +   Bo  |
|    .o. +   Bo.  |
|     . .S. B.=   |
|  . .  .o o B..  |
| . .. .  . +  .  |
|. .o +       .   |
|....o .      E.  |
+----[SHA256]-----+
ssh-copy-id root@172.16.9.195
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/eltex-pg1-v21/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@172.16.9.195's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'root@172.16.9.195'"
and check to make sure that only the key(s) you wanted were added.

ssh root@172.16.9.195
cat ~/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDAKJpwtOe3E7Q5/iSaHXSOxrbi9v8ZfZnXY4eFCEs6ju7RyBfHtu2hXDWHR26TQam/w4P1pERhJDzbTpZn/3MIodqcuuZFvVps5uWHj9+/qAztcIYbN5r1f7PSYEZ7VW95WqtTlWfTTLPq3GpPUZHMFRiYVccMj6yqzxlXUoWByCKaiNHs4JxdqtPhsTxOt8PxjpUDRUpF47XR8gxwzQQBP3vyuW+osCMkDXsywzCAMcwHbSjYBE+Ag4CGwh/QBQP3YKXiRpSl8qSL9STJEIEzxaeHpWpPwR2n0JOGibtwfbux/QhwwKzbjeDvBvfaUL99rCLBHdapMwPOQjq26IYiWL0C1+/XhxprmzwNyY5Z3oKq0y9DHYiHIXEjZRd1j2qL8Q6gdYebsUFnuKx3WmtN2+gt8xEbQHM677/5IRAifL10ITPE8CwtQC+OvEQUkhus0kxWgiMhwakLYVkGKQoL+7XqZ68Ae6vGx22tOJN4NIexv+vJq5BWqd+LtD4qPys= eltex-pg1-v21@eltex-2025-autumn
ls -la ~/.ssh/authorized_keys
-rw------- 1 root root 585 Oct 16 07:22 /root/.ssh/authorized_keys
logout
cat ~/.ssh/*.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDAKJpwtOe3E7Q5/iSaHXSOxrbi9v8ZfZnXY4eFCEs6ju7RyBfHtu2hXDWHR26TQam/w4P1pERhJDzbTpZn/3MIodqcuuZFvVps5uWHj9+/qAztcIYbN5r1f7PSYEZ7VW95WqtTlWfTTLPq3GpPUZHMFRiYVccMj6yqzxlXUoWByCKaiNHs4JxdqtPhsTxOt8PxjpUDRUpF47XR8gxwzQQBP3vyuW+osCMkDXsywzCAMcwHbSjYBE+Ag4CGwh/QBQP3YKXiRpSl8qSL9STJEIEzxaeHpWpPwR2n0JOGibtwfbux/QhwwKzbjeDvBvfaUL99rCLBHdapMwPOQjq26IYiWL0C1+/XhxprmzwNyY5Z3oKq0y9DHYiHIXEjZRd1j2qL8Q6gdYebsUFnuKx3WmtN2+gt8xEbQHM677/5IRAifL10ITPE8CwtQC+OvEQUkhus0kxWgiMhwakLYVkGKQoL+7XqZ68Ae6vGx22tOJN4NIexv+vJq5BWqd+LtD4qPys= eltex-pg1-v21@eltex-2025-autumn
ls -la ~/.ssh/*.pub
-rw-r--r-- 1 eltex-pg1-v21 eltex-pg1-v21 585 Oct 16 14:21 /home/eltex-pg1-v21/.ssh/id_rsa.pub
ssh root@172.16.9.195
useradd -m -s /bin/bash user1
passwd user1
New password:
Retype new password:
passwd: password updated successfully
adduser user2
info: Adding user `user2' ...
info: Selecting UID/GID from range 1000 to 59999 ...
info: Adding new group `user2' (1002) ...
info: Adding new user `user2' (1002) with group `user2 (1002)' ...
info: Creating home directory `/home/user2' ...
info: Copying files from `/etc/skel' ...
New password:
Retype new password:
passwd: password updated successfully
Changing the user information for user2
Enter the new value, or press ENTER for the default
        Full Name []:
        Room Number []:
        Work Phone []:
        Home Phone []:
        Other []:
Is the information correct? [Y/n] y
info: Adding new user `user2' to supplemental / extra groups `users' ...
info: Adding user `user2' to group `users' ...
adduser user3
info: Adding user `user3' ...
info: Selecting UID/GID from range 1000 to 59999 ...
info: Adding new group `user3' (1003) ...
info: Adding new user `user3' (1003) with group `user3 (1003)' ...
info: Creating home directory `/home/user3' ...
info: Copying files from `/etc/skel' ...
New password:
Retype new password:
passwd: password updated successfully
Changing the user information for user3
Enter the new value, or press ENTER for the default
        Full Name []:
        Room Number []:
        Work Phone []:
        Home Phone []:
        Other []:
Is the information correct? [Y/n] y
info: Adding new user `user3' to supplemental / extra groups `users' ...
info: Adding user `user3' to group `users' ...
usermod -s /usr/sbin/nologin user3
su user3
This account is currently not available.
su -s /bin/bash user3
su
Password:
groupadd sharegroup
usermod -aG sharegroup user1
usermod -aG sharegroup user2
usermod -aG sharegroup user3
groups user1
user1 : user1 sharegroup
groups user2
user2 : user2 users sharegroup
groups user3
user3 : user3 users sharegroup
mkdir -p /opt/share
chown :sharegroup /opt/share
ls -la /opt/share
total 8
drwxr-xr-x 2 root sharegroup 4096 Oct 16 07:39 .
drwxr-xr-x 3 root root       4096 Oct 16 07:39 ..
chmod 2770 /opt/share
ls -ld /opt/share
drwxrws--- 2 root sharegroup 4096 Oct 16 07:39 /opt/share
su user1
umask 027
exit
exit
su user1 -c "touch /opt/share/file_user1.txt"
su user2 -c "touch /opt/share/file_user2.txt"
su user3 -s /bin/bash -c "touch /opt/share/file_user3.txt"
su user1
cd /opt/share
ls
file_user1.txt  file_user2.txt  file_user3.txt
rm file_user1.txt
rm file_user2.txt
rm file_user3.txt
ls

exit
chmod 3770 /opt/share
ls -ld /opt/share
drwxrws--T 2 root sharegroup 4096 Oct 16 07:47 /opt/share
su user1 -c "touch /opt/share/file_user1.txt"
su user2 -c "touch /opt/share/file_user2.txt"
su user3 -s /bin/bash -c "touch /opt/share/file_user3.txt"
su user1
ls /opt/share
file_user1.txt  file_user2.txt  file_user3.txt
rm /opt/share/file_user1.txt
rm /opt/share/file_user2.txt
rm: cannot remove '/opt/share/file_user2.txt': Operation not permitted
rm /opt/share/file_user3.txt
rm: cannot remove '/opt/share/file_user3.txt': Operation not permitted
exit
usermod -aG sudo user1
su user1
To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

sudo dmesg | head -3
[sudo] password for user1:
[    0.000000] Linux version 6.8.0-55-generic (buildd@lcy02-amd64-095) (x86_64-linux-gnu-gcc-13 (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #57-Ubuntu SMP PREEMPT_DYNAMIC Wed Feb 12 23:42:21 UTC 2025 (Ubuntu 6.8.0-55.57-generic 6.8.12)
[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-6.8.0-55-generic root=/dev/mapper/ubuntu--vg-ubuntu--lv ro
[    0.000000] KERNEL supported cpus:
exit
visudo -f /etc/sudoers.d/dmesg_user2
cat /etc/sudoers.d/dmesg_user2
user2 ALL=(ALL) NOPASSWD: /usr/bin/dmesg
nano /usr/local/bin/dmesg_suid.sh
cat /usr/local/bin/dmesg_suid.sh
#!/bin/bash
sudo /usr/bin/dmesg "$@"
chown root:root /usr/local/bin/dmesg_suid.sh
chmod 4755 /usr/local/bin/dmesg_suid.sh
su user2
/usr/local/bin/dmesg_suid.sh | head -5
[    0.000000] Linux version 6.8.0-55-generic (buildd@lcy02-amd64-095) (x86_64-linux-gnu-gcc-13 (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #57-Ubuntu SMP PREEMPT_DYNAMIC Wed Feb 12 23:42:21 UTC 2025 (Ubuntu 6.8.0-55.57-generic 6.8.12)
[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-6.8.0-55-generic root=/dev/mapper/ubuntu--vg-ubuntu--lv ro
[    0.000000] KERNEL supported cpus:
[    0.000000]   Intel GenuineIntel
[    0.000000]   AMD AuthenticAMD
exit
chage -M 10 user1
chage -M 10 user2
chage -M 10 user3

chage -l user1
Last password change                                    : Oct 16, 2025
Password expires                                        : Oct 26, 2025
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 10
Number of days of warning before password expires       : 7

chage -l user2
Last password change                                    : Oct 16, 2025
Password expires                                        : Oct 26, 2025
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 10
Number of days of warning before password expires       : 7

chage -l user3
Last password change                                    : Oct 16, 2025
Password expires                                        : Oct 26, 2025
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 10
Number of days of warning before password expires       : 7
echo "Павел Мазин" >> /etc/motd
cat /etc/motd
Павел Мазин
rsync -av /etc/ /root/etc_backup/
sent 2,451,006 bytes  received 19,414 bytes  1,646,946.67 bytes/sec
total size is 2,366,545  speedup is 0.96
ls -la /root/etc_backup/ |head -10
total 940
drwxr-xr-x 109 root root       4096 Oct 16 14:16 .
drwx------   9 root root       4096 Oct 16 14:17 ..
-rw-r--r--   1 root root       3444 Jul  5  2023 adduser.conf
drwxr-xr-x   2 root root       4096 Oct 16 06:34 alternatives
drwxr-xr-x   2 root root       4096 Feb 16  2025 apparmor
drwxr-xr-x   9 root root       4096 Feb 16  2025 apparmor.d
drwxr-xr-x   3 root root       4096 Oct 16 06:05 apport
drwxr-xr-x   9 root root       4096 Mar 12  2025 apt
-rw-r--r--   1 root root       2319 Mar 31  2024 bash.bashrc

tar -cf etc_backup.tar /root/etc_backup/
tar: Removing leading `/' from member names

7z a /root/etc_backup_7z.7z /root/etc_backup.tar

7-Zip 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20
 64-bit locale=en_US.UTF-8 Threads:2 OPEN_MAX:1024

Scanning the drive:
1 file, 3471360 bytes (3390 KiB)

Creating archive: /root/etc_backup_7z.7z

Add new data to archive: 1 file, 3471360 bytes (3390 KiB)


Files read from disk: 1
Archive size: 486740 bytes (476 KiB)
Everything is Ok

rm etc_backup.tar

tar -czf etc_backup_gz.tar.gz /root/etc_backup/
tar: Removing leading `/' from member names
tar -cjf etc_backup_bz2.tar.bz2 /root/etc_backup/
tar: Removing leading `/' from member names

ls -lh etc_backup_*.*
-rw-r--r-- 1 root root 476K Oct 16 15:48 etc_backup_7z.7z
-rw-r--r-- 1 root root 553K Oct 16 15:50 etc_backup_bz2.tar.bz2
-rw-r--r-- 1 root root 583K Oct 16 15:50 etc_backup_gz.tar.gz

echo "Обновлено: $(date)" >> /etc/motd
cat /etc/motd
Павел Мазин
Обновлено: Thu Oct 16 04:26:29 PM UTC 2025

rsync -av --delete /etc/ /root/etc_backup/
sending incremental file list
motd

sent 70,032 bytes  received 283 bytes  140,630.00 bytes/sec
total size is 2,366,597  speedup is 33.66

tar -czf etc_backup_update_gz.tar.gz /root/etc_backup/
tar: Removing leading `/' from member names

find /root/etc_backup | wc -l
1745
tar -tf /root/etc_backup_bz2.tar.bz2 | wc -l
1745

mkdir -p /root/etc_backup_gzip /root/etc_backup_7zip

tar -xzf /root/etc_backup_update_gz.tar.gz -C /root/etc_backup_gzip

cd /root/etc_backup_7zip
7za x /root/etc_backup_7z.7z

7-Zip (a) 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20
 64-bit locale=en_US.UTF-8 Threads:2 OPEN_MAX:1024

Scanning the drive for archives:
1 file, 486728 bytes (476 KiB)

Extracting archive: /root/etc_backup_7z.7z
--
Path = /root/etc_backup_7z.7z
Type = 7z
Physical Size = 486728
Headers Size = 138
Method = LZMA2:22
Solid = -
Blocks = 1

Everything is Ok

Size:       3471360
Compressed: 486728

diff etc_backup_gzip/root/etc_backup/motd etc_backup_7zip/root/etc_backup/motd
2d1
< Обновлено: Thu Oct 16 04:26:29 PM UTC 2025





